# RSpec-Autograder

## Quickstart:

To use, add the following to  `info.json`  in your question 
```json
"gradingMethod": "External",
"externalGradingOptions": {
        "enabled": true,
        "image" : "saasbook/pl-rspec-autograder",
        "entrypoint": "/grader/run.py",
        "timeout" : 60
    }
```

Define a variant to be a version of the codebase that forms a complete program. This project uses "variants" to determine if a student submission is correct. 

A question writer must create the following in their PrarieLearn question
- the folder `tests/` in the root directory of their question 
  - subfolder `tests/common/`
    - which will contain the code that is shared between variants*
  - json file `tests/meta.json`
    - which will contain 
      - the mapping of `_submission_file` as a value for the key `"submission_file"`
      - (optional) the location to which additional submitted files would be copied
  - subfolder `tests/solution/`
    - which must contain the file `_submission_file` that has the instructor solution
  - a number of subfolders `tests/suite<number>`
    - each of which contains the difference from the files in `tests/common/` expressed by including a modified copy of the file that should be replaced/added to `tests/common/`

\* This should include packaged gems (i.e. the result of `bundle package --all && bundle install --development` or whichever package environment you wish to use)

The `tests/` folder in your question should look something like this:
```
tests/
+-- common/
|   +-- .bundle/
|   +-- spec/
|   +-- vendor/
|   +-- Gemfile
|   +-- Gemfile.lock
|   `-- replaced.rb
|
+-- solution/
|   +-- _submission_file  # this will hold the instructor's "submission"
|   |
|   ...                # any other submitted files can be included*
|
+-- var_description_of_this_variant/
|   `-- replaced.rb    # this file will replace the one in common
|
`-- meta.json          # this will contain the aforementioned mappings
```
*The student would need to submit additional files in the file submission box on the right of each question, yet this feature has not yet been tested

## Grading Structure:

For each variant (consider `<var_i>`) the following is done:
1) make an empty working directory (`working/`)
2) load the files from `tests/common/` into `working/`
3) load the files from `tests/<var_i>/` into `working/`  
4) load the solution into `working/`
    - in which `_submission_file` will be appended to the file detailed in `meta.json`
    - and if `"submission_root"` is defined in `meta.json`, all files are copied to `working/<submission_root>`
5) run the `GRADING_SCRIPT` (in `parse.py`) and serialize the output into `Var` objects
    - `GRADING_SCRIPT` is defined in `grader/parse.py` and is by default
      ```$ cd working/ && bundle install --quiet && rspec --format json```
6) repeat steps 1-3
7) load the student submission (which will be loaded into `suites/submission` upon launch of the image) into `working/`
    - the text input by the student will be in `tests/submission/_submission_file`
    - all other files will be in `tests/submission/`
8) repeat step 5
9) compare the `Var` object generated by the student's submission to that of the instructor's solution and report results to prairielearn

